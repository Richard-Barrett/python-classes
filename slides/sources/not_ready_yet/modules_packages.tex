% python classes slides - modules and packages
% (c) 2012 Kostiantyn Danylov aka koder 
% koder.mail@gmail.com
% distributed under CC-BY licence
% http://creativecommons.org/licenses/by/3.0/deed.en

\documentclass{article}
\input{files/lectures_env}
\input{files/python_cmds}

\begin{document}
\LARGE

%-------------------------------------------------------------------------------
\begin{center} Модули \end{center}
\begin{itemize}
	\item python файлы в папке с текущим модулем или в sys.path
	\item .py => \{.pyc, .pyo\}
	\item .pyo = .pyc - asserts
	\item .pyd / .so
	\item \lstinline!import mod_name!
	\item \lstinline!import mod_name as new_name!
	\item \lstinline!from mod_name import obj_name, obj_name2!
	\item \lstinline!from mod_name import obj_name as obj_name2!
	\item \lstinline!from mod_name import *! все кроме \_.* или все из \lstinline!__all__!
\end{itemize}
\newpage

%-------------------------------------------------------------------------------
\begin{center} Пример модуля - mod.py \end{center}
\begin{lstlisting}
	__all__ = ["some_val", "func"]
	
	some_val = 16

	def func(x):
		return x + some_val
\end{lstlisting}

\begin{center} Использование \end{center}
\begin{lstlisting}
	from mod import some_val, func

	print func(1)
\end{lstlisting}
\newpage

%-------------------------------------------------------------------------------
\begin{itemize}
	\item sys.path
	\item sys.modules
	\item \_\_import\_\_
	\item importlib.import\_module
	\item imp
\end{itemize}
\newpage

%-------------------------------------------------------------------------------
\begin{center} \_\_import\_\_ \end{center}
\begin{lstlisting}
	fc = open(module_file_path).read()
	module_code = compile(fc, module_file, "exec")
	loc = {}
	eval(module_code, loc)
	sys.modules[module_name] = ModuleObject(loc)
	func = loc['func']
\end{lstlisting}
\newpage

%-------------------------------------------------------------------------------
\begin{center} Подмена модуля \end{center}
\begin{lstlisting}
	class SomeClass(object):
		def m(self):
			return 1

	sys.modules['mod'] = SomeClass()
	from mod import m

	print m() # 1
\end{lstlisting}
\newpage

%-------------------------------------------------------------------------------
% \begin{center} Пакеты \end{center}
% \begin{verbatim}
% xml\
% 	__init__.py
%     expat\
%         __init__.py
%         bindings.py
%     dom\
%         __init__.py
%         ...
%     sax\
%         __init__.py
%         ...
%     xmltree\
%     	__init__.py
%     	XmlTree.py
%     	....
% \end{verbatim}
% \newpage

%-------------------------------------------------------------------------------
\begin{center} Пакеты \end{center}
\begin{itemize}
	\item \lstinline!import xml! => xml/\_\_init\_\_.py
	\item \lstinline!import xml.expat! => xml/expat/\_\_init\_\_.py
	\item Циклические импорты
	\item package.\_\_path\_\_
\end{itemize}
\newpage

%-------------------------------------------------------------------------------
\begin{center} Специальные атрибуты \end{center}
\begin{itemize}
	\item \_\_autor\_\_
	\item \_\_name\_\_
	\item \_\_doc\_\_
\end{itemize}

\begin{lstlisting}
	import sys

	def main(argv=None):
		argv = argv if args is not None else sys.argv
		...
		return code

	if __name__ == "__main__":
		sys.exit(main())
\end{lstlisting}
\newpage

%-------------------------------------------------------------------------------
\begin{center} Исполнение модуля \end{center}
\begin{itemize}
	\item python -m ....
\end{itemize}
\newpage

%-------------------------------------------------------------------------------
\end{document}








